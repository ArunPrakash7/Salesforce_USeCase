import { LightningElement, wire } from 'lwc';
import getDirectorQueueCases from '@salesforce/apex/DirectorQueueHandler.getDirectorQueueCases';
import updateCaseStatus from '@salesforce/apex/CaseHandler.updateCaseStatus';

export default class CaseStatusUpdate extends LightningElement {
    cases;
    selectedCaseIds = [];
    selectedStatus;
    statusOptions = [{ label: 'Approved', value: 'Approved' }, { label: 'Cancelled', value: 'Cancelled' }];

    @wire(getDirectorQueueCases)
    wiredCases({ error, data }) {
        if (data) {
            this.cases = data.map(item => ({ ...item, selected: false }));
        } else if (error) {
            console.error('Error loading cases:', error);
        }
    }

    handleCheckboxChange(event) {
        const caseId = event.target.value;
        const checked = event.target.checked;
        
        this.cases = this.cases.map(item => {
            if (item.Id === caseId) {
                item.selected = checked;
            }
            return item;
        });

        this.selectedCaseIds = this.cases.filter(item => item.selected).map(item => item.Id);
    }

    handleStatusChange(event) {
        this.selectedStatus = event.detail.value;
    }

    handleNext() {
        if (this.selectedCaseIds.length > 0 && this.selectedStatus) {
            updateCaseStatus({ caseIds: this.selectedCaseIds, status: this.selectedStatus })
                .then(() => {
                    // Handle success message or any other action
                    console.log('Cases updated successfully.');
                })
                .catch(error => {
                    console.error('Error updating cases:', error);
                });
        }
    }
}
 <template>
    <lightning-card title="Cases in Director Queue" icon-name="standard:case">
        <lightning-layout>
            <template if:true={cases}>
                <template for:each={cases} for:item="caseRec">
                    <div key={caseRec.Id}>
                        <lightning-input type="checkbox" label={caseRec.Subject} value={caseRec.Id} checked={caseRec.selected} onchange={handleCheckboxChange}></lightning-input>
                    </div>
                </template>
                <div style="margin-top: 10px;">
                    <lightning-radio-group name="status" options={statusOptions} value={selectedStatus} onchange={handleStatusChange}></lightning-radio-group>
                </div>
                <div style="margin-top: 10px;">
                    <lightning-button label="Next" variant="brand" onclick={handleNext}></lightning-button>
                </div>
            </template>
            <template if:false={cases}>
                <p>No cases found in the Director Queue.</p>
            </template>
        </lightning-layout>
    </lightning-card>
</template>
